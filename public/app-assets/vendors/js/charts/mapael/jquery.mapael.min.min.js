/*!
 *
 * Jquery Mapael - Dynamic maps jQuery plugin (based on raphael.js)
 * Requires jQuery, raphael.js and jquery.mousewheel
 *
 * Version: 2.0.0-dev
 *
 * Copyright (c) 2015 Vincent Brout√© (http://www.vincentbroute.fr/mapael)
 * Licensed under the MIT license (http://www.opensource.org/licenses/mit-license.php).
 *
 * Thanks to Indigo744
 *
 */
;!function(b){"object"==typeof exports?module.exports=b(require("jquery"),require("raphael"),require("mousewheel")):"function"==typeof define&&define.amd?define(["jquery","raphael","mousewheel"],b):b(jQuery,Raphael,jQuery.fn.mousewheel)}(function(i,h,n,m){var l="mapael",k="2.0.0-dev",j=function(a,f){var e=this;e.container=a,e.$container=i(a),e.options=e.extendDefaultOptions(f),e.initialHTMLContent=e.$container.html(),e.zoomTO=0,e.zoomCenterX=0,e.zoomCenterY=0,e.previousPinchDist=0,e.zoomData={zoomLevel:0,zoomX:0,zoomY:0,panX:0,panY:0},e.resizeTO=0,e.panning=!1,e.panningTO=0,e.animationIntervalID=null,e.$map={},e.$tooltip={},e.paper={},e.areas={},e.plots={},e.links={},e.mapConf={},e.init()};j.prototype={version:k,init:function(){var a=this;if(""===a.options.map.cssClass||0===i("."+a.options.map.cssClass,a.container).length){throw new Error("The map class `"+a.options.map.cssClass+"` doesn't exists")}if(a.$tooltip=i("<div>").addClass(a.options.map.tooltip.cssClass).css("display","none"),a.$map=i("."+a.options.map.cssClass,a.container).empty().append(a.$tooltip),i[l]&&i[l].maps&&i[l].maps[a.options.map.name]){a.mapConf=i[l].maps[a.options.map.name]}else{if(!(i.fn[l]&&i.fn[l].maps&&i.fn[l].maps[a.options.map.name])){throw new Error("Unknown map '"+a.options.map.name+"'")}a.mapConf=i.fn[l].maps[a.options.map.name],window.console&&window.console.warn&&window.console.warn("Extending $.fn.mapael is deprecated (map '"+a.options.map.name+"')")}if(a.paper=new h(a.$map[0],a.mapConf.width,a.mapConf.height),a.isRaphaelBBoxBugPresent()===!0){throw a.destroy(),new Error("Can't get boundary box for text (is your container hidden? See #135)")}a.$container.addClass(l),a.options.map.tooltip.css&&a.$tooltip.css(a.options.map.tooltip.css),a.paper.setViewBox(0,0,a.mapConf.width,a.mapConf.height,!1),i.each(a.mapConf.elems,function(d){var c=a.getElemOptions(a.options.map.defaultArea,a.options.areas[d]?a.options.areas[d]:{},a.options.legend.area);a.areas[d]={mapElem:a.paper.path(a.mapConf.elems[d]).attr(c.attrs)}}),a.options.map.beforeInit&&a.options.map.beforeInit(a.$container,a.paper,a.options),i.each(a.mapConf.elems,function(d){var c=a.getElemOptions(a.options.map.defaultArea,a.options.areas[d]?a.options.areas[d]:{},a.options.legend.area);a.initElem(a.areas[d],c,d)}),a.links=a.drawLinksCollection(a.options.links),i.each(a.options.plots,function(b){a.plots[b]=a.drawPlot(b)}),a.$container.on("zoom."+l,function(d,c){a.onZoomEvent(d,c)}),a.options.map.zoom.enabled&&a.initZoom(a.mapConf.width,a.mapConf.height,a.options.map.zoom),a.options.map.zoom.init!==m&&(a.options.map.zoom.init.animDuration===m&&(a.options.map.zoom.init.animDuration=0),a.$container.trigger("zoom."+l,a.options.map.zoom.init)),a.createLegends("area",a.areas,1),a.$container.on("update."+l,function(d,c){a.onUpdateEvent(d,c)}),a.$container.on("showElementsInRange."+l,function(d,c){a.onShowElementsInRange(d,c)}),a.options.map.width?(a.paper.setSize(a.options.map.width,a.mapConf.height*(a.options.map.width/a.mapConf.width)),a.createLegends("plot",a.plots,a.options.map.width/a.mapConf.width)):a.handleMapResizing(),a.options.map.afterInit&&a.options.map.afterInit(a.$container,a.paper,a.areas,a.plots,a.options),i(a.paper.desc).append(" and Mapael "+a.version+" (http://www.vincentbroute.fr/mapael/)")},destroy:function(){var a=this;a.$container.off("."+l),a.$container.empty(),a.onResizeEvent&&i(window).off("resize."+l,a.onResizeEvent),a.$container.html(a.initialHTMLContent),a.$container.removeClass(l),a.$container.removeData(l),a.container=m,a.$container=m,a.options=m,a.paper=m,a.$map=m,a.$tooltip=m,a.mapConf=m,a.areas=m,a.plots=m,a.links=m},handleMapResizing:function(){var a=this;a.onResizeEvent=function(){clearTimeout(a.resizeTO),a.resizeTO=setTimeout(function(){a.$map.trigger("resizeEnd."+l)},150)},i(window).on("resize."+l,a.onResizeEvent),a.$map.on("resizeEnd."+l,function(){var b=a.$map.width();if(a.paper.width!=b){var d=b/a.mapConf.width;a.paper.setSize(b,a.mapConf.height*d),a.createLegends("plot",a.plots,d)}}).trigger("resizeEnd."+l)},extendDefaultOptions:function(a){return a=i.extend(!0,{},j.prototype.defaultOptions,a),i.each(a.legend,function(e){if(i.isArray(a.legend[e])){for(var b=0;b<a.legend[e].length;++b){a.legend[e][b]=i.extend(!0,{},j.prototype.legendDefaultOptions[e],a.legend[e][b])}}else{a.legend[e]=i.extend(!0,{},j.prototype.legendDefaultOptions[e],a.legend[e])}}),a},initElem:function(a,r,q){var p=this,o={},d={};r.value!==m&&(a.value=r.value),r.text&&r.text.content!==m&&(o=a.mapElem.getBBox(),d=p.getTextPosition(o,r.text.position,r.text.margin),r.text.attrs["text-anchor"]=d.textAnchor,a.textElem=p.paper.text(d.x,d.y,r.text.content).attr(r.text.attrs),i(a.textElem.node).attr("data-id",q)),r.eventHandlers&&p.setEventHandlers(q,r,a.mapElem,a.textElem),(i.isEmptyObject(r.attrsHover)===!1||a.textElem&&i.isEmptyObject(r.text.attrsHover)===!1)&&(p.setHoverOptions(a.mapElem,r.attrs,r.attrsHover),a.textElem&&p.setHoverOptions(a.textElem,r.text.attrs,r.text.attrsHover),p.setHover(a.mapElem,a.textElem)),r.tooltip&&(a.mapElem.tooltip=r.tooltip,p.setTooltip(a.mapElem),r.text&&r.text.content!==m&&(a.textElem.tooltip=r.tooltip,p.setTooltip(a.textElem))),r.href&&(a.mapElem.href=r.href,a.mapElem.target=r.target,p.setHref(a.mapElem),r.text&&r.text.content!==m&&(a.textElem.href=r.href,a.textElem.target=r.target,p.setHref(a.textElem))),i(a.mapElem.node).attr("data-id",q)},initZoom:function(a,s,r){var q=this,p=!1,o=0,e=0,d={reset:function(){q.$container.trigger("zoom."+l,{level:0})},"in":function(){q.$container.trigger("zoom."+l,{level:"+1"})},out:function(){q.$container.trigger("zoom."+l,{level:-1})}};i.extend(q.zoomData,{zoomLevel:0,panX:0,panY:0}),i.each(r.buttons,function(g,u){if(d[g]===m){throw new Error("Unknown zoom button '"+g+"'")}var t=i("<div>").addClass(u.cssClass).html(u.content).attr("title",u.title);t.on("click."+l,d[g]),q.$map.append(t)}),q.options.map.zoom.mousewheel&&q.$map.on("mousewheel."+l,function(g){var f=g.deltaY>0?1:-1,t=q.mapPagePositionToXY(g.pageX,g.pageY);return q.$container.trigger("zoom."+l,{fixedCenter:!0,level:q.zoomData.zoomLevel+f,x:t.x,y:t.y}),!1}),q.options.map.zoom.touch&&(q.$map.on("touchstart."+l,function(b){2===b.originalEvent.touches.length&&(q.zoomCenterX=(b.originalEvent.touches[0].pageX+b.originalEvent.touches[1].pageX)/2,q.zoomCenterY=(b.originalEvent.touches[0].pageY+b.originalEvent.touches[1].pageY)/2,q.previousPinchDist=Math.sqrt(Math.pow(b.originalEvent.touches[1].pageX-b.originalEvent.touches[0].pageX,2)+Math.pow(b.originalEvent.touches[1].pageY-b.originalEvent.touches[0].pageY,2)))}),q.$map.on("touchmove."+l,function(g){var f=0,u=0;if(2===g.originalEvent.touches.length){if(f=Math.sqrt(Math.pow(g.originalEvent.touches[1].pageX-g.originalEvent.touches[0].pageX,2)+Math.pow(g.originalEvent.touches[1].pageY-g.originalEvent.touches[0].pageY,2)),Math.abs(f-q.previousPinchDist)>15){var t=q.mapPagePositionToXY(q.zoomCenterX,q.zoomCenterY);u=(f-q.previousPinchDist)/Math.abs(f-q.previousPinchDist),q.$container.trigger("zoom."+l,{fixedCenter:!0,level:q.zoomData.zoomLevel+u,x:t.x,y:t.y}),q.previousPinchDist=f}return !1}})),i("body").on("mouseup."+l+(r.touch?" touchend":""),function(){p=!1,setTimeout(function(){q.panning=!1},50)}),q.$map.on("mousedown."+l+(r.touch?" touchstart":""),function(b){b.pageX!==m?(p=!0,o=b.pageX,e=b.pageY):1===b.originalEvent.touches.length&&(p=!0,o=b.originalEvent.touches[0].pageX,e=b.originalEvent.touches[0].pageY)}).on("mousemove."+l+(r.touch?" touchmove":""),function(u){var f=q.zoomData.zoomLevel,c=0,b=0;if(u.pageX!==m?(c=u.pageX,b=u.pageY):1===u.originalEvent.touches.length?(c=u.originalEvent.touches[0].pageX,b=u.originalEvent.touches[0].pageY):p=!1,p&&0!==f){var w=(o-c)/(1+f*r.step)*(a/q.paper.width),v=(e-b)/(1+f*r.step)*(s/q.paper.height),t=Math.min(Math.max(0,q.paper._viewBox[0]+w),a-q.paper._viewBox[2]),g=Math.min(Math.max(0,q.paper._viewBox[1]+v),s-q.paper._viewBox[3]);return(Math.abs(w)>5||Math.abs(v)>5)&&(i.extend(q.zoomData,{panX:t,panY:g,zoomX:t+q.paper._viewBox[2]/2,zoomY:g+q.paper._viewBox[3]/2}),q.paper.setViewBox(t,g,q.paper._viewBox[2],q.paper._viewBox[3]),clearTimeout(q.panningTO),q.panningTO=setTimeout(function(){q.$map.trigger("afterPanning",{x1:t,y1:g,x2:t+q.paper._viewBox[2],y2:g+q.paper._viewBox[3]})},150),o=c,e=b,q.panning=!0),!1}})},mapPagePositionToXY:function(o,g){var s=this,r=s.$map.offset(),q=s.options.map.width?s.mapConf.width/s.options.map.width:s.mapConf.width/s.$map.width(),p=1/(1+s.zoomData.zoomLevel*s.options.map.zoom.step);return{x:p*q*(o-r.left)+s.zoomData.panX,y:p*q*(g-r.top)+s.zoomData.panY}},onZoomEvent:function(x,w){var v=this,u=v.zoomData.zoomLevel,t=0,s=0,r=1+v.zoomData.zoomLevel*v.options.map.zoom.step,q=0,p=w.animDuration!==m?w.animDuration:v.options.map.zoom.animDuration,o=0,d=0,a={};w.level!==m&&(u="string"==typeof w.level?"+"===w.level.slice(0,1)||"-"===w.level.slice(0,1)?v.zoomData.zoomLevel+parseInt(w.level):parseInt(w.level):w.level<0?v.zoomData.zoomLevel+w.level:w.level,u=Math.min(Math.max(u,v.options.map.zoom.minLevel),v.options.map.zoom.maxLevel)),q=1+u*v.options.map.zoom.step,w.latitude!==m&&w.longitude!==m&&(a=v.mapConf.getCoords(w.latitude,w.longitude),w.x=a.x,w.y=a.y),w.x===m&&(w.x=v.paper._viewBox[0]+v.paper._viewBox[2]/2),w.y===m&&(w.y=v.paper._viewBox[1]+v.paper._viewBox[3]/2),0===u?(t=0,s=0):w.fixedCenter!==m&&w.fixedCenter===!0?(o=v.zoomData.panX+(w.x-v.zoomData.panX)*(q-r)/q,d=v.zoomData.panY+(w.y-v.zoomData.panY)*(q-r)/q,t=Math.min(Math.max(0,o),v.mapConf.width-v.mapConf.width/q),s=Math.min(Math.max(0,d),v.mapConf.height-v.mapConf.height/q)):(t=Math.min(Math.max(0,w.x-v.mapConf.width/q/2),v.mapConf.width-v.mapConf.width/q),s=Math.min(Math.max(0,w.y-v.mapConf.height/q/2),v.mapConf.height-v.mapConf.height/q)),(q!=r||t!=v.zoomData.panX||s!=v.zoomData.panY)&&(p>0?v.animateViewBox(t,s,v.mapConf.width/q,v.mapConf.height/q,p,v.options.map.zoom.animEasing):(v.paper.setViewBox(t,s,v.mapConf.width/q,v.mapConf.height/q),clearTimeout(v.zoomTO),v.zoomTO=setTimeout(function(){v.$map.trigger("afterZoom",{x1:t,y1:s,x2:t+v.mapConf.width/q,y2:s+v.mapConf.height/q})},150)),i.extend(v.zoomData,{zoomLevel:u,panX:t,panY:s,zoomX:t+v.paper._viewBox[2]/2,zoomY:s+v.paper._viewBox[3]/2}))},onShowElementsInRange:function(e,d){var f=this;d.animDuration===m&&(d.animDuration=0),d.hiddenOpacity===m&&(d.hiddenOpacity=0.3),d.ranges&&d.ranges.area&&f.showElemByRange(d.ranges.area,f.areas,d.hiddenOpacity,d.animDuration),d.ranges&&d.ranges.plot&&f.showElemByRange(d.ranges.plot,f.plots,d.hiddenOpacity,d.animDuration),d.ranges&&d.ranges.link&&f.showElemByRange(d.ranges.link,f.links,d.hiddenOpacity,d.animDuration),d.afterShowRange&&d.afterShowRange()},showElemByRange:function(a,r,q,p){var o=this,d={};(a.min!==m||a.max!==m)&&(a={0:a}),i.each(a,function(c){var b=a[c];return b.min===m&&b.max===m?!0:void i.each(r,function(f){var e=r[f].value;return"object"!=typeof e&&(e=[e]),e[c]===m?!0:void (b.min!==m&&e[c]<b.min||b.max!==m&&e[c]>b.max?d[f]=q:d[f]=1)})}),i.each(d,function(b){o.setElementOpacity(r[b],d[b],p)})},setElementOpacity:function(e,d,f){e.mapElem.stop(),e.textElem&&e.textElem.stop(),d>0&&(e.mapElem.show(),e.textElem&&e.textElem.show()),f>0?(e.mapElem.animate({opacity:d},f,"linear",function(){0===d&&e.mapElem.hide()}),e.textElem&&e.textElem.animate({opacity:d},f,"linear",function(){0===d&&e.textElem.hide()})):(e.mapElem.attr({opacity:d}),0===d&&e.mapElem.hide(),e.textElem&&(e.textElem.attr({opacity:d}),0===d&&e.textElem.hide()))},onUpdateEvent:function(t,s){var r=this;if("object"==typeof s){var q=0,p=s.animDuration?s.animDuration:0,o=function(b){r.unsetHover(b.mapElem,b.textElem),p>0?(b.mapElem.animate({opacity:0},p,"linear",function(){b.mapElem.remove()}),b.textElem&&b.textElem.animate({opacity:0},p,"linear",function(){b.textElem.remove()})):(b.mapElem.remove(),b.textElem&&b.textElem.remove())},e=function(b){b.mapElem.attr({opacity:0}),b.textElem&&b.textElem.attr({opacity:0}),r.setElementOpacity(b,b.mapElem.originalAttrs.opacity!==m?b.mapElem.originalAttrs.opacity:1,p)};if("object"==typeof s.mapOptions&&(s.replaceOptions===!0?r.options=r.extendDefaultOptions(s.mapOptions):i.extend(!0,r.options,s.mapOptions),(s.mapOptions.areas!==m||s.mapOptions.plots!==m||s.mapOptions.legend!==m)&&i("[data-type='elem']",r.$container).each(function(f,g){"1"===i(g).attr("data-hidden")&&i(g).trigger("click."+l,[!1,p])})),"object"==typeof s.deletePlotKeys){for(;q<s.deletePlotKeys.length;q++){r.plots[s.deletePlotKeys[q]]!==m&&(o(r.plots[s.deletePlotKeys[q]]),delete r.plots[s.deletePlotKeys[q]])}}else{"all"===s.deletePlotKeys&&(i.each(r.plots,function(f,c){o(c)}),r.plots={})}if("object"==typeof s.deleteLinkKeys){for(q=0;q<s.deleteLinkKeys.length;q++){r.links[s.deleteLinkKeys[q]]!==m&&(o(r.links[s.deleteLinkKeys[q]]),delete r.links[s.deleteLinkKeys[q]])}}else{"all"===s.deleteLinkKeys&&(i.each(r.links,function(f,c){o(c)}),r.links={})}if("object"==typeof s.newPlots&&i.each(s.newPlots,function(b){r.plots[b]===m&&(r.options.plots[b]=s.newPlots[b],r.plots[b]=r.drawPlot(b),p>0&&e(r.plots[b]))}),"object"==typeof s.newLinks){var d=r.drawLinksCollection(s.newLinks);i.extend(r.links,d),i.extend(r.options.links,s.newLinks),p>0&&i.each(d,function(b){e(d[b])})}if(i.each(r.areas,function(f){var c=r.getElemOptions(r.options.map.defaultArea,r.options.areas[f]?r.options.areas[f]:{},r.options.legend.area);r.updateElem(c,r.areas[f],p)}),i.each(r.plots,function(f){var c=r.getElemOptions(r.options.map.defaultPlot,r.options.plots[f]?r.options.plots[f]:{},r.options.legend.plot);"square"==c.type?(c.attrs.width=c.size,c.attrs.height=c.size,c.attrs.x=r.plots[f].mapElem.attrs.x-(c.size-r.plots[f].mapElem.attrs.width)/2,c.attrs.y=r.plots[f].mapElem.attrs.y-(c.size-r.plots[f].mapElem.attrs.height)/2):"image"==c.type?(c.attrs.width=c.width,c.attrs.height=c.height,c.attrs.x=r.plots[f].mapElem.attrs.x-(c.width-r.plots[f].mapElem.attrs.width)/2,c.attrs.y=r.plots[f].mapElem.attrs.y-(c.height-r.plots[f].mapElem.attrs.height)/2):c.attrs.r=c.size/2,r.updateElem(c,r.plots[f],p)}),i.each(r.links,function(f){var c=r.getElemOptions(r.options.map.defaultLink,r.options.links[f]?r.options.links[f]:{},{});r.updateElem(c,r.links[f],p)}),s.mapOptions&&"object"==typeof s.mapOptions.legend&&(r.createLegends("area",r.areas,1),r.options.map.width?r.createLegends("plot",r.plots,r.options.map.width/r.mapConf.width):r.createLegends("plot",r.plots,r.$map.width()/r.mapConf.width)),"object"==typeof s.setLegendElemsState){i.each(s.setLegendElemsState,function(f,v){var u=r.$container.find("."+f)[0];u!==m&&i("[data-type='elem']",u).each(function(c,g){("0"===i(g).attr("data-hidden")&&"hide"===v||"1"===i(g).attr("data-hidden")&&"show"===v)&&i(g).trigger("click."+l,[!1,p])})})}else{var a="hide"===s.setLegendElemsState?"hide":"show";i("[data-type='elem']",r.$container).each(function(f,g){("0"===i(g).attr("data-hidden")&&"hide"===a||"1"===i(g).attr("data-hidden")&&"show"===a)&&i(g).trigger("click."+l,[!1,p])})}s.afterUpdate&&s.afterUpdate(r.$container,r.paper,r.areas,r.plots,r.options)}},drawLinksCollection:function(a){var s=this,r={},q={},p={},o={},d={};return i.each(a,function(b){var c=s.getElemOptions(s.options.map.defaultLink,a[b],{});r="string"==typeof a[b].between[0]?s.options.plots[a[b].between[0]]:a[b].between[0],q="string"==typeof a[b].between[1]?s.options.plots[a[b].between[1]]:a[b].between[1],r.latitude!==m&&r.longitude!==m?p=s.mapConf.getCoords(r.latitude,r.longitude):(p.x=r.x,p.y=r.y),q.latitude!==m&&q.longitude!==m?o=s.mapConf.getCoords(q.latitude,q.longitude):(o.x=q.x,o.y=q.y),d[b]=s.drawLink(b,p.x,p.y,o.x,o.y,c)}),d},drawLink:function(L,K,J,I,H,G){var F=this,E={},D=(K+I)/2,C=(J+H)/2,B=-1/((H-J)/(I-K)),A=C-B*D,z=Math.sqrt((I-K)*(I-K)+(H-J)*(H-J)),y=1+B*B,x=-2*D+2*B*A-2*B*C,w=D*D+A*A-A*C-C*A+C*C-G.factor*z*(G.factor*z),v=x*x-4*y*w,u=0,t=0;return G.factor>0?(u=(-x+Math.sqrt(v))/(2*y),t=B*u+A):(u=(-x-Math.sqrt(v))/(2*y),t=B*u+A),E.mapElem=F.paper.path("m "+K+","+J+" C "+u+","+t+" "+I+","+H+" "+I+","+H).attr(G.attrs),F.initElem(E,G,L),E},updateElem:function(o,d,u){var t,s,r,q=this,p=d.mapElem.getBBox();o.value!==m&&(d.value=o.value),d.textElem&&(o.text!==m&&o.text.content!==m&&o.text.content!=d.textElem.attrs.text&&d.textElem.attr({text:o.text.content}),(o.size||o.width&&o.height)&&("image"==o.type||"svg"==o.type?(s=(o.width-p.width)/2,r=(o.height-p.height)/2):(s=(o.size-p.width)/2,r=(o.size-p.height)/2),p.x-=s,p.x2+=s,p.y-=r,p.y2+=r),t=q.getTextPosition(p,o.text.position,o.text.margin),(t.x!=d.textElem.attrs.x||t.y!=d.textElem.attrs.y)&&(u>0?(d.textElem.attr({"text-anchor":t.textAnchor}),d.textElem.animate({x:t.x,y:t.y},u)):d.textElem.attr({x:t.x,y:t.y,"text-anchor":t.textAnchor})),q.setHoverOptions(d.textElem,o.text.attrs,o.text.attrsHover),u>0?d.textElem.animate(o.text.attrs,u):d.textElem.attr(o.text.attrs)),q.setHoverOptions(d.mapElem,o.attrs,o.attrsHover),u>0?d.mapElem.animate(o.attrs,u):d.mapElem.attr(o.attrs),"svg"==o.type&&d.mapElem.transform("m"+o.width/d.mapElem.originalWidth+",0,0,"+o.height/d.mapElem.originalHeight+","+p.x+","+p.y),o.tooltip&&(d.mapElem.tooltip===m&&(q.setTooltip(d.mapElem),d.textElem&&q.setTooltip(d.textElem)),d.mapElem.tooltip=o.tooltip,d.textElem&&(d.textElem.tooltip=o.tooltip)),o.href!==m&&(d.mapElem.href===m&&(q.setHref(d.mapElem),d.textElem&&q.setHref(d.textElem)),d.mapElem.href=o.href,d.mapElem.target=o.target,d.textElem&&(d.textElem.href=o.href,d.textElem.target=o.target))},drawPlot:function(g){var d=this,q={},p={},o=d.getElemOptions(d.options.map.defaultPlot,d.options.plots[g]?d.options.plots[g]:{},d.options.legend.plot);return p=o.x!==m&&o.y!==m?{x:o.x,y:o.y}:d.mapConf.getCoords(o.latitude,o.longitude),"square"==o.type?q={mapElem:d.paper.rect(p.x-o.size/2,p.y-o.size/2,o.size,o.size).attr(o.attrs)}:"image"==o.type?q={mapElem:d.paper.image(o.url,p.x-o.width/2,p.y-o.height/2,o.width,o.height).attr(o.attrs)}:"svg"==o.type?(q={mapElem:d.paper.path(o.path).attr(o.attrs)},q.mapElem.originalWidth=q.mapElem.getBBox().width,q.mapElem.originalHeight=q.mapElem.getBBox().height,q.mapElem.transform("m"+o.width/q.mapElem.originalWidth+",0,0,"+o.height/q.mapElem.originalHeight+","+(p.x-o.width/2)+","+(p.y-o.height/2))):q={mapElem:d.paper.circle(p.x,p.y,o.size/2).attr(o.attrs)},d.initElem(q,o,g),q},setHref:function(a){var d=this;a.attr({cursor:"pointer"}),i(a.node).on("click."+l,function(){!d.panning&&a.href&&window.open(a.href,a.target)})},setTooltip:function(a){var p=this,o=0,e=p.$tooltip.attr("class"),d=function(b,g){var c={left:Math.min(p.$map.width()-p.$tooltip.outerWidth()-5,b-p.$map.offset().left+10),top:Math.min(p.$map.height()-p.$tooltip.outerHeight()-5,g-p.$map.offset().top+20)};a.tooltip.overflow!==m&&(a.tooltip.overflow.right!==m&&a.tooltip.overflow.right===!0&&(c.left=b-p.$map.offset().left+10),a.tooltip.overflow.bottom!==m&&a.tooltip.overflow.bottom===!0&&(c.top=g-p.$map.offset().top+20)),p.$tooltip.css(c)};i(a.node).on("mouseover."+l,function(b){o=setTimeout(function(){if(p.$tooltip.attr("class",e),a.tooltip!==m){if(a.tooltip.content!==m){var c="function"==typeof a.tooltip.content?a.tooltip.content(a):a.tooltip.content;p.$tooltip.html(c).css("display","block")}a.tooltip.cssClass!==m&&p.$tooltip.addClass(a.tooltip.cssClass)}d(b.pageX,b.pageY)},120)}).on("mouseout."+l,function(){clearTimeout(o),p.$tooltip.css("display","none")}).on("mousemove."+l,function(b){d(b.pageX,b.pageY)})},setEventHandlers:function(a,q,p,o){var g=this;i.each(q.eventHandlers,function(b){!function(c){i(p.node).on(c,function(d){g.panning||q.eventHandlers[c](d,a,p,o,q)}),o&&i(o.node).on(c,function(d){g.panning||q.eventHandlers[c](d,a,p,o,q)})}(b)})},drawLegend:function(R,Q,P,O,N){var M=this,L={},K={},J=0,I=0,H=null,G={},F={},E={},D=0,C=0,B=0,A=0,z=[],d=0;for(L=i("."+R.cssClass,M.$container).empty(),K=new h(L.get(0)),i(K.canvas).attr({"data-type":Q,"data-index":N}),I=J=0,R.title&&""!==R.title&&(H=K.text(R.marginLeftTitle,0,R.title).attr(R.titleAttrs),H.attr({y:0.5*H.getBBox().height}),J=R.marginLeftTitle+H.getBBox().width,I+=R.marginBottomTitle+H.getBBox().height),D=0,d=R.slices.length;d>D;++D){var b=0;R.slices[D].size===m&&(R.slices[D].size=M.options.map.defaultPlot.size),R.slices[D].legendSpecificAttrs===m&&(R.slices[D].legendSpecificAttrs={}),z[D]=i.extend({},"plot"==Q?M.options.map.defaultPlot.attrs:M.options.map.defaultArea.attrs,R.slices[D].attrs,R.slices[D].legendSpecificAttrs),"area"==Q?(z[D].width===m&&(z[D].width=30),z[D].height===m&&(z[D].height=20)):"square"==R.slices[D].type?(z[D].width===m&&(z[D].width=R.slices[D].size),z[D].height===m&&(z[D].height=R.slices[D].size)):"image"==R.slices[D].type||"svg"==R.slices[D].type?(z[D].width===m&&(z[D].width=R.slices[D].width),z[D].height===m&&(z[D].height=R.slices[D].height)):z[D].r===m&&(z[D].r=R.slices[D].size/2),b=R.marginBottomTitle,H&&(b+=H.getBBox().height),b+="plot"!=Q||R.slices[D].type!==m&&"circle"!=R.slices[D].type?O*z[D].height/2:O*z[D].r,A=Math.max(A,b)}for("horizontal"==R.mode&&(J=R.marginLeft),D=0,d=R.slices.length;d>D;++D){if(R.slices[D].display===m||R.slices[D].display===!0){if("area"==Q?("horizontal"==R.mode?(C=J+R.marginLeft,B=A-0.5*O*z[D].height):(C=R.marginLeft,B=I),G=K.rect(C,B,O*z[D].width,O*z[D].height)):"square"==R.slices[D].type?("horizontal"==R.mode?(C=J+R.marginLeft,B=A-0.5*O*z[D].height):(C=R.marginLeft,B=I),G=K.rect(C,B,O*z[D].width,O*z[D].height)):"image"==R.slices[D].type||"svg"==R.slices[D].type?("horizontal"==R.mode?(C=J+R.marginLeft,B=A-0.5*O*z[D].height):(C=R.marginLeft,B=I),"image"==R.slices[D].type?G=K.image(R.slices[D].url,C,B,O*z[D].width,O*z[D].height):(G=K.path(R.slices[D].path),G.transform("m"+O*R.slices[D].width/G.getBBox().width+",0,0,"+O*R.slices[D].height/G.getBBox().height+","+C+","+B))):("horizontal"==R.mode?(C=J+R.marginLeft+O*z[D].r,B=A):(C=R.marginLeft+O*z[D].r,B=I+O*z[D].r),G=K.circle(C,B,O*z[D].r)),delete z[D].width,delete z[D].height,delete z[D].r,G.attr(z[D]),F=G.getBBox(),"horizontal"==R.mode?(C=J+R.marginLeft+F.width+R.marginLeftLabel,B=A):(C=R.marginLeft+F.width+R.marginLeftLabel,B=I+F.height/2),E=K.text(C,B,R.slices[D].label).attr(R.labelAttrs),"horizontal"==R.mode){var a=R.marginBottom+F.height;J+=R.marginLeft+F.width+R.marginLeftLabel+E.getBBox().width,"image"!=R.slices[D].type&&"area"!=Q&&(a+=R.marginBottomTitle),H&&(a+=H.getBBox().height),I=Math.max(I,a)}else{J=Math.max(J,R.marginLeft+F.width+R.marginLeftLabel+E.getBBox().width),I+=R.marginBottom+F.height}i(G.node).attr({"data-type":"elem","data-index":D,"data-hidden":0}),i(E.node).attr({"data-type":"label","data-index":D,"data-hidden":0}),R.hideElemsOnClick.enabled&&(E.attr({cursor:"pointer"}),G.attr({cursor:"pointer"}),M.setHoverOptions(G,z[D],z[D]),M.setHoverOptions(E,R.labelAttrs,R.labelAttrsHover),M.setHover(G,E),M.handleClickOnLegendElem(R,R.slices[D],E,G,P,N))}}"SVG"!=h.type&&R.VMLWidth&&(J=R.VMLWidth),K.setSize(J,I)},handleClickOnLegendElem:function(a,s,r,q,p,o){var e=this,d=function(f,c,b){var u=0,t=i(r.node).attr("data-hidden"),g="0"===t?{"data-hidden":"1"}:{"data-hidden":"0"};b===m&&(b=a.hideElemsOnClick.animDuration),"0"===t?b>0?r.animate({opacity:0.5},b):r.attr({opacity:0.5}):b>0?r.animate({opacity:1},b):r.attr({opacity:1}),i.each(p,function(w){var v=p[w].mapElem.data("hidden-by");v===m&&(v={}),u=i.isArray(p[w].value)?p[w].value[o]:p[w].value,(s.sliceValue!==m&&u==s.sliceValue||s.sliceValue===m&&(s.min===m||u>=s.min)&&(s.max===m||u<=s.max))&&!function(x){"0"===t?(v[o]=!0,e.setElementOpacity(p[x],a.hideElemsOnClick.opacity,b)):(delete v[o],i.isEmptyObject(v)&&e.setElementOpacity(p[x],p[x].mapElem.originalAttrs.opacity!==m?p[x].mapElem.originalAttrs.opacity:1,b)),p[x].mapElem.data("hidden-by",v)}(w)}),i(q.node).attr(g),i(r.node).attr(g),c!==m&&c!==!0||a.exclusive===m||a.exclusive!==!0||i("[data-type='elem'][data-hidden=0]",e.$container).each(function(){i(this).attr("data-index")!==i(q.node).attr("data-index")&&i(this).trigger("click."+l,!1)})};i(r.node).on("click."+l,d),i(q.node).on("click."+l,d),s.clicked!==m&&s.clicked===!0&&i(q.node).trigger("click."+l,!1)},createLegends:function(a,s,r){var q=this,p=q.options.legend[a];i.isArray(q.options.legend[a])||(p=[q.options.legend[a]]);for(var o=0;o<p.length;++o){if(""===p[o].cssClass||0===i("."+p[o].cssClass,q.$container).length){throw new Error("The legend class `"+p[o].cssClass+"` doesn't exists.")}p[o].display===!0&&i.isArray(p[o].slices)&&p[o].slices.length>0&&q.drawLegend(p[o],a,s,r,o)}},setHoverOptions:function(f,b,a){"SVG"!=h.type&&delete a.transform,f.attrsHover=a,f.attrsHover.transform?f.originalAttrs=i.extend({transform:"s1"},b):f.originalAttrs=b},setHover:function(u,t){var s=this,r={},q={},p=0,o=0,e=function(){clearTimeout(o),p=setTimeout(function(){s.elemHover(u,t)},120)},a=function(){clearTimeout(p),o=setTimeout(function(){s.elemOut(u,t)},120)};r=i(u.node),r.on("mouseover."+l,e),r.on("mouseout."+l,a),t&&(q=i(t.node),q.on("mouseover."+l,e),i(t.node).on("mouseout."+l,a))},unsetHover:function(a,d){i(a.node).off("."+l),d&&i(d.node).off("."+l)},elemHover:function(e,d){var f=this;e.attrsHover.animDuration>0?e.animate(e.attrsHover,e.attrsHover.animDuration):e.attr(e.attrsHover),d&&(d.attrsHover.animDuration>0?d.animate(d.attrsHover,d.attrsHover.animDuration):d.attr(d.attrsHover)),f.paper.safari&&f.paper.safari()},elemOut:function(e,d){var f=this;e.attrsHover.animDuration>0?e.animate(e.originalAttrs,e.attrsHover.animDuration):e.attr(e.originalAttrs),d&&(d.attrsHover.animDuration>0?d.animate(d.originalAttrs,d.attrsHover.animDuration):d.attr(d.originalAttrs)),f.paper.safari&&f.paper.safari()},getElemOptions:function(a,s,r){var q=this,p=i.extend(!0,{},a,s);if(p.value!==m){if(i.isArray(r)){for(var o=0,d=r.length;d>o;++o){p=i.extend(!0,{},p,q.getLegendSlice(p.value[o],r[o]))}}else{p=i.extend(!0,{},p,q.getLegendSlice(p.value,r))}}return p},getTextPosition:function(o,g,s){var r=0,q=0,p="";switch("number"==typeof s&&(s="bottom"===g||"top"===g?{x:0,y:s}:"right"===g||"left"===g?{x:s,y:0}:{x:0,y:0}),g){case"bottom":r=(o.x+o.x2)/2+s.x,q=o.y2+s.y,p="middle";break;case"top":r=(o.x+o.x2)/2+s.x,q=o.y-s.y,p="middle";break;case"left":r=o.x-s.x,q=(o.y+o.y2)/2+s.y,p="end";break;case"right":r=o.x2+s.x,q=(o.y+o.y2)/2+s.y,p="start";break;default:r=(o.x+o.x2)/2+s.x,q=(o.y+o.y2)/2+s.y,p="middle"}return{x:r,y:q,textAnchor:p}},getLegendSlice:function(f,d){for(var o=0,g=d.slices.length;g>o;++o){if(d.slices[o].sliceValue!==m&&f==d.slices[o].sliceValue||d.slices[o].sliceValue===m&&(d.slices[o].min===m||f>=d.slices[o].min)&&(d.slices[o].max===m||f<=d.slices[o].max)){return d.slices[o]}}return{}},animateViewBox:function(L,K,J,I,H,G){var F,E=this,D=E.paper._viewBox?E.paper._viewBox[0]:0,C=L-D,B=E.paper._viewBox?E.paper._viewBox[1]:0,A=K-B,z=E.paper._viewBox?E.paper._viewBox[2]:E.paper.width,y=J-z,x=E.paper._viewBox?E.paper._viewBox[3]:E.paper.height,w=I-x,v=25,u=H/v,b=0;G=G||"linear",F=h.easing_formulas[G],clearInterval(E.animationIntervalID),E.animationIntervalID=setInterval(function(){var a=b/u;E.paper.setViewBox(D+C*F(a),B+A*F(a),z+y*F(a),x+w*F(a),!1),b++>=u&&(clearInterval(E.animationIntervalID),clearTimeout(E.zoomTO),E.zoomTO=setTimeout(function(){E.$map.trigger("afterZoom",{x1:L,y1:K,x2:L+J,y2:K+I})},150))},v)},isRaphaelBBoxBugPresent:function(){var e=this,d=e.paper.text(-50,-50,"TEST"),f=d.getBBox();return d.remove(),0===f.width&&0===f.height},defaultOptions:{map:{cssClass:"map",tooltip:{cssClass:"mapTooltip"},defaultArea:{attrs:{fill:"#343434",stroke:"#5d5d5d","stroke-width":1,"stroke-linejoin":"round"},attrsHover:{fill:"#f38a03",animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},defaultPlot:{type:"circle",size:15,attrs:{fill:"#0088db",stroke:"#fff","stroke-width":0,"stroke-linejoin":"round"},attrsHover:{"stroke-width":3,animDuration:300},text:{position:"right",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},defaultLink:{factor:0.5,attrs:{stroke:"#0088db","stroke-width":2},attrsHover:{animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},zoom:{enabled:!1,minLevel:0,maxLevel:10,step:0.25,mousewheel:!0,touch:!0,animDuration:200,animEasing:"linear",buttons:{reset:{cssClass:"zoomButton zoomReset",content:"&#8226;",title:"Reset zoom"},"in":{cssClass:"zoomButton zoomIn",content:"+",title:"Zoom in"},out:{cssClass:"zoomButton zoomOut",content:"&#8722;",title:"Zoom out"}}}},legend:{area:[],plot:[]},areas:{},plots:{},links:{}},legendDefaultOptions:{area:{cssClass:"areaLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:0.2,animDuration:300},slices:[],mode:"vertical"},plot:{cssClass:"plotLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:0.2,animDuration:300},slices:[],mode:"vertical"}}},i[l]===m&&(i[l]=j),i.fn[l]=function(a){return this.each(function(){i.data(this,l)&&i.data(this,l).destroy(),i.data(this,l,new j(this,a))})}});