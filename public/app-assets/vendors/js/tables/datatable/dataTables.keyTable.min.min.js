/*!
 KeyTable 2.3.2
 Â©2009-2017 SpryMedia Ltd - datatables.net/license
*/
(function(a){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(b){return a(b,window,document)}):"object"===typeof exports?module.exports=function(b,c){b||(b=window);if(!c||!c.fn.dataTable){c=require("datatables.net")(b,c).$}return a(c,b,b.document)}:a(jQuery,window,document)})(function(d,b,c,e){var a=d.fn.dataTable,g=function(h,f){if(!a.versionCheck||!a.versionCheck("1.10.8")){throw"KeyTable requires DataTables 1.10.8 or newer"}this.c=d.extend(!0,{},a.defaults.keyTable,g.defaults,f);this.s={dt:new a.Api(h),enable:!0,focusDraw:!1,waitingForDraw:!1,lastFocus:null};this.dom={};var j=this.s.dt.settings()[0],i=j.keytable;if(i){return i}j.keytable=this;this._constructor()};d.extend(g.prototype,{blur:function(){this._blur()},enable:function(f){this.s.enable=f},focus:function(h,f){this._focus(this.s.dt.cell(h,f))},focused:function(h){if(!this.s.lastFocus){return !1}var f=this.s.lastFocus.cell.index();return h.row===f.row&&h.column===f.column},_constructor:function(){this._tabInput();var h=this,f=this.s.dt,k=d(f.table().node());"static"===k.css("position")&&k.css("position","relative");d(f.table().body()).on("click.keyTable","th, td",function(m){if(!1!==h.s.enable){var l=f.cell(this);l.any()&&h._focus(l,null,!1,m)}});d(c).on("keydown.keyTable",function(l){h._key(l)});if(this.c.blurable){d(c).on("mousedown.keyTable",function(l){d(l.target).parents(".dataTables_filter").length&&h._blur();d(l.target).parents().filter(f.table().container()).length||d(l.target).parents("div.DTE").length||d(l.target).parents("div.editor-datetime").length||d(l.target).parents().filter(".DTFC_Cloned").length||h._blur()})}if(this.c.editor){var j=this.c.editor;j.on("open.keyTableMain",function(l,m){"inline"!==m&&h.s.enable&&(h.enable(!1),j.one("close.keyTable",function(){h.enable(!0)}))});if(this.c.editOnFocus){f.on("key-focus.keyTable key-refocus.keyTable",function(l,o,n,m){h._editor(null,m)})}f.on("key.keyTable",function(l,p,o,n,m){h._editor(o,m)})}if(f.settings()[0].oFeatures.bStateSave){f.on("stateSaveParams.keyTable",function(l,n,m){m.keyTable=h.s.lastFocus?h.s.lastFocus.cell.index():null})}f.on("draw.keyTable",function(o){if(!h.s.focusDraw){var n=h.s.lastFocus;if(n&&n.node&&d(n.node).closest("body")===c.body){var n=h.s.lastFocus.relative,m=f.page.info(),l=n.row+m.start;0!==m.recordsDisplay&&(l>=m.recordsDisplay&&(l=m.recordsDisplay-1),h._focus(l,n.column,!0,o))}}});f.on("destroy.keyTable",function(){f.off(".keyTable");d(f.table().body()).off("click.keyTable","th, td");d(c.body).off("keydown.keyTable").off("click.keyTable")});var i=f.state.loaded();if(i&&i.keyTable){f.one("init",function(){var l=f.cell(i.keyTable);l.any()&&l.focus()})}else{this.c.focus&&f.cell(this.c.focus).focus()}},_blur:function(){if(this.s.enable&&this.s.lastFocus){var f=this.s.lastFocus.cell;d(f.node()).removeClass(this.c.className);this.s.lastFocus=null;this._updateFixedColumns(f.index().column);this._emitEvent("key-blur",[this.s.dt,f])}},_clipboardCopy:function(){var h=this.s.dt;if(this.s.lastFocus&&b.getSelection&&!b.getSelection().toString()){var f=this.s.lastFocus.cell.render("display"),j=d("<div/>").css({height:1,width:1,overflow:"hidden",position:"fixed",top:0,left:0}),f=d("<textarea readonly/>").val(f).appendTo(j);try{j.appendTo(h.table().container()),f[0].focus(),f[0].select(),c.execCommand("copy")}catch(i){}j.remove()}},_columns:function(){var h=this.s.dt,f=h.columns(this.c.columns).indexes(),i=[];h.columns(":visible").every(function(j){-1!==f.indexOf(j)&&i.push(j)});return i},_editor:function(h,f){var k=this,j=this.s.dt,i=this.c.editor;!d("div.DTE",this.s.lastFocus.cell.node()).length&&16!==h&&(f.stopPropagation(),13===h&&f.preventDefault(),i.one("open.keyTable",function(){i.off("cancelOpen.keyTable");k.c.editAutoSelect&&d("div.DTE_Field_InputControl input, div.DTE_Field_InputControl textarea").select();j.keys.enable(k.c.editorKeys);j.one("key-blur.editor",function(){i.displayed()&&i.submit()});i.one("close",function(){j.keys.enable(!0);j.off("key-blur.editor")})}).one("cancelOpen.keyTable",function(){i.off("open.keyTable")}).inline(this.s.lastFocus.cell.index()))},_emitEvent:function(h,f){this.s.dt.iterator("table",function(i){d(i.nTable).triggerHandler(h,f)})},_focus:function(r,q,p,o){var n=this,f=this.s.dt,l=f.page.info(),k=this.s.lastFocus;o||(o=null);if(this.s.enable){if("number"!==typeof r){var h=r.index(),q=h.column,r=f.rows({filter:"applied",order:"applied"}).indexes().indexOf(h.row);l.serverSide&&(r+=l.start)}if(-1!==l.length&&(r<l.start||r>=l.start+l.length)){this.s.focusDraw=!0,this.s.waitingForDraw=!0,f.one("draw",function(){n.s.focusDraw=!1;n.s.waitingForDraw=!1;n._focus(r,q,e,o)}).page(Math.floor(r/l.length)).draw(!1)}else{if(-1!==d.inArray(q,this._columns())){l.serverSide&&(r-=l.start);l=f.cells(null,q,{search:"applied",order:"applied"}).flatten();l=f.cell(l[r]);if(k){if(k.node===l.node()){this._emitEvent("key-refocus",[this.s.dt,l,o||null]);return}this._blur()}k=d(l.node());k.addClass(this.c.className);this._updateFixedColumns(q);if(p===e||!0===p){this._scroll(d(b),d(c.body),k,"offset"),p=f.table().body().parentNode,p!==f.table().header().parentNode&&(p=d(p.parentNode),this._scroll(p,p,k,"position"))}this.s.lastFocus={cell:l,node:l.node(),relative:{row:f.rows({page:"current"}).indexes().indexOf(l.index().row),column:l.index().column}};this._emitEvent("key-focus",[this.s.dt,l,o||null]);f.state.save()}}}},_key:function(h){if(this.s.waitingForDraw){h.preventDefault()}else{var f=this.s.enable,j=!0===f||"navigation-only"===f;if(f){if(h.ctrlKey&&67===h.keyCode){this._clipboardCopy()}else{if(!(0===h.keyCode||h.ctrlKey||h.metaKey||h.altKey)&&this.s.lastFocus){var i=this.s.dt;if(!(this.c.keys&&-1===d.inArray(h.keyCode,this.c.keys))){switch(h.keyCode){case 9:this._shift(h,h.shiftKey?"left":"right",!0);break;case 27:this.s.blurable&&!0===f&&this._blur();break;case 33:case 34:j&&(h.preventDefault(),i.page(33===h.keyCode?"previous":"next").draw(!1));break;case 35:case 36:j&&(h.preventDefault(),f=i.cells({page:"current"}).indexes(),j=this._columns(),this._focus(i.cell(f[35===h.keyCode?f.length-1:j[0]]),null,!0,h));break;case 37:j&&this._shift(h,"left");break;case 38:j&&this._shift(h,"up");break;case 39:j&&this._shift(h,"right");break;case 40:j&&this._shift(h,"down");break;default:!0===f&&this._emitEvent("key",[i,h.keyCode,this.s.lastFocus.cell,h])}}}}}}},_scroll:function(t,s,r,q){var p=r[q](),o=r.outerHeight(),n=r.outerWidth(),l=s.scrollTop(),k=s.scrollLeft(),m=t.height(),t=t.width();"position"===q&&(p.top+=parseInt(r.closest("table").css("top"),10));p.top<l&&s.scrollTop(p.top);p.left<k&&s.scrollLeft(p.left);p.top+o>l+m&&o<m&&s.scrollTop(p.top+o-m);p.left+n>k+t&&n<t&&s.scrollLeft(p.left+n-t)},_shift:function(r,q,p){var o=this.s.dt,n=o.page.info(),l=n.recordsDisplay,m=this.s.lastFocus.cell,k=this._columns();if(m){var f=o.rows({filter:"applied",order:"applied"}).indexes().indexOf(m.index().row);n.serverSide&&(f+=n.start);o=o.columns(k).indexes().indexOf(m.index().column);n=k[o];"right"===q?o>=k.length-1?(f++,n=k[0]):n=k[o+1]:"left"===q?0===o?(f--,n=k[k.length-1]):n=k[o-1]:"up"===q?f--:"down"===q&&f++;0<=f&&f<l&&-1!==d.inArray(n,k)?(r.preventDefault(),this._focus(f,n,!0,r)):!p||!this.c.blurable?r.preventDefault():this._blur()}},_tabInput:function(){var h=this,f=this.s.dt,i=null!==this.c.tabIndex?this.c.tabIndex:f.settings()[0].iTabIndex;if(-1!=i){d('<div><input type="text" tabindex="'+i+'"/></div>').css({position:"absolute",height:1,width:0,overflow:"hidden"}).insertBefore(f.table().node()).children().on("focus",function(j){f.cell(":eq(0)",{page:"current"}).any()&&h._focus(f.cell(":eq(0)","0:visible",{page:"current"}),null,!0,j)})}},_updateFixedColumns:function(h){var f=this.s.dt,j=f.settings()[0];if(j._oFixedColumns){var i=j.aoColumns.length-j._oFixedColumns.s.iRightColumns;(h<j._oFixedColumns.s.iLeftColumns||h>=i)&&f.fixedColumns().update()}}});g.defaults={blurable:!0,className:"focus",columns:"",editor:null,editorKeys:"navigation-only",editAutoSelect:!0,editOnFocus:!1,focus:null,keys:null,tabIndex:null};g.version="2.3.2";d.fn.dataTable.KeyTable=g;d.fn.DataTable.KeyTable=g;a.Api.register("cell.blur()",function(){return this.iterator("table",function(f){f.keytable&&f.keytable.blur()})});a.Api.register("cell().focus()",function(){return this.iterator("cell",function(h,f,i){h.keytable&&h.keytable.focus(f,i)})});a.Api.register("keys.disable()",function(){return this.iterator("table",function(f){f.keytable&&f.keytable.enable(!1)})});a.Api.register("keys.enable()",function(f){return this.iterator("table",function(h){h.keytable&&h.keytable.enable(f===e?!0:f)})});a.ext.selector.cell.push(function(i,h,m){var h=h.focused,i=i.keytable,l=[];if(!i||h===e){return m}for(var k=0,j=m.length;k<j;k++){(!0===h&&i.focused(m[k])||!1===h&&!i.focused(m[k]))&&l.push(m[k])}return l});d(c).on("preInit.dt.dtk",function(h,f){if("dt"===h.namespace){var j=f.oInit.keys,i=a.defaults.keys;if(j||i){i=d.extend({},i,j),!1!==j&&new g(f,i)}}});return g});