$(function(){var a=0,b=function(e,d){this.$lobiList=e,this.$options=d,this.$globalOptions=e.$options,this.$items={},this._init()};b.prototype={$lobiList:null,$el:null,$elWrapper:null,$options:{},$items:{},$globalOptions:{},$ul:null,$header:null,$title:null,$form:null,$footer:null,$body:null,eventsSuppressed:!1,_init:function(){var e=this;e.suppressEvents(),e.$options.id||(e.$options.id="lobilist-list-"+a++);var f=$('<div class="lobilist-wrapper"></div>'),d=$('<div id="'+e.$options.id+'" class="lobilist"></div>').appendTo(f);e.$options.defaultStyle&&d.addClass(e.$options.defaultStyle),e.$el=d,e.$elWrapper=f,e.$header=e._createHeader(),e.$title=e._createTitle(),e.$body=e._createBody(),e.$ul=e._createList(),e.$options.items&&e._createItems(e.$options.items),e.$form=e._createForm(),e.$body.append(e.$ul,e.$form),e.$footer=e._createFooter(),e.$globalOptions.sortable&&e._enableSorting(),e.resumeEvents()},addItem:function(f,d){var e=this;return e._triggerEvent("beforeItemAdd",[e,f])===!1?e:(f=e._processItemData(f),e.$globalOptions.actions.insert?$.ajax(e.$globalOptions.actions.insert,{data:f,method:"POST"}).done(function(g){g.success?(f.id=g.id,e._addItemToList(f)):d&&"function"==typeof d&&d(g)}):(f.id=e.$lobiList.getNextId(),e._addItemToList(f)),e)},updateItem:function(f,d){var e=this;return e._triggerEvent("beforeItemUpdate",[e,f])===!1?e:(e.$globalOptions.actions.update?$.ajax(e.$globalOptions.actions.update,{data:f,method:"POST"}).done(function(g){g.success?e._updateItemInList(f):d&&"function"==typeof d&&d(g)}):e._updateItemInList(f),e)},deleteItem:function(f,d){var e=this;return e._triggerEvent("beforeItemDelete",[e,f])===!1?e:e.$globalOptions.actions["delete"]?e._sendAjax(e.$globalOptions.actions["delete"],{data:f,method:"POST"}).done(function(g){g.success?e._removeItemFromList(f):d&&"function"==typeof d&&d(g)}):(e._removeItemFromList(f),e)},saveOrUpdateItem:function(f,d){var e=this;return f.id?e.updateItem(f,d):e.addItem(f,d),e},startTitleEditing:function(){var e=this,d=e._createInput();return e.$title.attr("data-old-title",e.$title.html()),d.val(e.$title.html()),d.insertAfter(e.$title),e.$title.addClass("hide"),e.$header.addClass("title-editing"),d[0].focus(),d[0].select(),e},finishTitleEditing:function(){var e=this,f=e.$header.find("input"),d=e.$title.attr("data-old-title");return e.$title.html(f.val()).removeClass("hide").removeAttr("data-old-title"),f.remove(),e.$header.removeClass("title-editing"),console.log(d,f.val()),e._triggerEvent("titleChange",[e,d,f.val()]),e},cancelTitleEditing:function(){var d=this,e=d.$header.find("input");return 0===e.length?d:(d.$title.html(d.$title.attr("data-old-title")).removeClass("hide"),e.remove(),d.$header.removeClass("title-editing"),d)},remove:function(){var d=this;return d.$lobiList.$lists.splice(d.$el.index(),1),d.$elWrapper.remove(),d},editItem:function(h){var g=this,f=g.$lobiList.$el.find("li[data-id="+h+"]"),e=f.closest(".lobilist").find(".lobilist-add-todo-form"),d=f.closest(".lobilist").find(".lobilist-footer");return e.removeClass("hide"),d.addClass("hide"),e[0].id.value=f.attr("data-id"),e[0].title.value=f.find(".lobilist-item-title").html(),e[0].description.value=f.find(".lobilist-item-description").html()||"",e[0].dueDate.value=f.find(".lobilist-item-duedate").html()||"",g},suppressEvents:function(){return this.eventsSuppressed=!0,this},resumeEvents:function(){return this.eventsSuppressed=!1,this},_processItemData:function(e){var d=this;return $.extend({},d.$globalOptions.itemOptions,e)},_createHeader:function(){var f=this,d=$("<div>",{"class":"lobilist-header"}),e=$("<div>",{"class":"lobilist-actions"}).appendTo(d);return f.$options.controls&&f.$options.controls.length>0&&(f.$options.controls.indexOf("styleChange")>-1&&e.append(f._createDropdownForStyleChange()),f.$options.controls.indexOf("edit")>-1&&(e.append(f._createEditTitleButton()),e.append(f._createFinishTitleEditing()),e.append(f._createCancelTitleEditing())),f.$options.controls.indexOf("add")>-1&&e.append(f._createAddNewButton()),f.$options.controls.indexOf("remove")>-1&&e.append(f._createCloseButton())),f.$el.append(d),d},_createTitle:function(){var e=this,d=$("<div>",{"class":"lobilist-title",html:e.$options.title}).appendTo(e.$header);return e.$options.controls&&e.$options.controls.indexOf("edit")>-1&&d.on("dblclick",function(){e.startTitleEditing()}),d},_createBody:function(){var d=this;return $("<div>",{"class":"lobilist-body"}).appendTo(d.$el)},_createForm:function(){var e=this,d=$("<form>",{"class":"lobilist-add-todo-form hide"});$('<input type="hidden" name="id">').appendTo(d),$('<div class="form-group">').append($("<input>",{type:"text",name:"title","class":"form-control",placeholder:"TODO title"})).appendTo(d),$('<div class="form-group">').append($("<textarea>",{rows:"2",name:"description","class":"form-control",placeholder:"TODO description"})).appendTo(d),$('<div class="form-group">').append($("<input>",{type:"text",name:"dueDate","class":"form-control",placeholder:"Due Date"})).appendTo(d);var f=$('<div class="lobilist-form-footer">');return $("<button>",{"class":"btn btn-primary btn-sm btn-add-todo",html:"Add"}).appendTo(f),$("<button>",{type:"button","class":"btn btn-default btn-sm btn-discard-todo",html:'<i class="glyphicon glyphicon-remove-circle"></i>'}).click(function(){d.addClass("hide"),e.$footer.removeClass("hide")}).appendTo(f),f.appendTo(d),e._formHandler(d),e.$el.append(d),d},_formHandler:function(d){var e=this;d.on("submit",function(f){f.preventDefault(),e._submitForm()})},_submitForm:function(){var d=this;return d.$form[0].title.value?(d.saveOrUpdateItem({id:d.$form[0].id.value,title:d.$form[0].title.value,description:d.$form[0].description.value,dueDate:d.$form[0].dueDate.value}),d.$form.addClass("hide"),void d.$footer.removeClass("hide")):void d._showFormError("title","Title can not be empty")},_createFooter:function(){var e=this,d=$("<div>",{"class":"lobilist-footer"});return $("<button>",{type:"button","class":"btn-link btn-show-form",html:"Add new"}).click(function(){e._resetForm(),e.$form.removeClass("hide"),d.addClass("hide")}).appendTo(d),e.$el.append(d),d},_createList:function(){var e=this,d=$("<ul>",{"class":"lobilist-items"});return e.$el.append(d),d},_createItems:function(d){for(var f=this,e=0;e<d.length;e++){f._addItem(d[e])}},_addItem:function(e){var d=this;e.id||(e.id=d.$lobiList.getNextId()),d._triggerEvent("beforeItemAdd",[d,e])!==!1&&(e=d._processItemData(e),d._addItemToList(e))},_createCheckbox:function(){var e=this,d=$("<input>",{type:"checkbox"});return d.change(function(){e._onCheckboxChange(this)}),$("<label>",{"class":"checkbox-inline lobilist-check"}).append(d)},_onCheckboxChange:function(e){var d=this,f=$(e);f.prop("checked")?d._triggerEvent("afterMarkAsDone",[d,f]):d._triggerEvent("afterMarkAsUndone",[d,f]),f.closest(".lobilist-item").toggleClass("item-done")},_createDropdownForStyleChange:function(){for(var g=this,h=$("<div>",{"class":"dropdown"}).append($("<button>",{type:"button","data-toggle":"dropdown","class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-th"></i>'})),f=$("<div>",{"class":"dropdown-menu dropdown-menu-right"}).appendTo(h),e=0;e<g.$globalOptions.listStyles.length;e++){var d=g.$globalOptions.listStyles[e];$('<div class="'+d+'"></div>').on("mousedown",function(i){i.stopPropagation()}).click(function(){for(var l=g.$el[0].className.split(" "),j=null,k=0;k<l.length;k++){g.$globalOptions.listStyles.indexOf(l[k])>-1&&(j=l[k])}g.$el.removeClass(g.$globalOptions.listStyles.join(" ")).addClass(this.className),g._triggerEvent("styleChange",[g,j,this.className])}).appendTo(f)}return h},_createEditTitleButton:function(){var e=this,d=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-edit"></i>'});return d.click(function(){e.startTitleEditing()}),d},_createAddNewButton:function(){var e=this,d=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-plus"></i>'});return d.click(function(){var f=e.$lobiList.addList();f.startTitleEditing()}),d},_createCloseButton:function(){var e=this,d=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-remove"></i>'});return d.click(e._onRemoveListClick),d},_onRemoveListClick:function(){var d=this;return d._triggerEvent("beforeListRemove",[d]),d.remove(),d._triggerEvent("afterListRemove",[d]),d},_createFinishTitleEditing:function(){var e=this,d=$("<button>",{"class":"btn btn-default btn-xs btn-finish-title-editing",html:'<i class="glyphicon glyphicon-ok-circle"></i>'});return d.click(function(){e.finishTitleEditing()}),d},_createCancelTitleEditing:function(){var e=this,d=$("<button>",{"class":"btn btn-default btn-xs btn-cancel-title-editing",html:'<i class="glyphicon glyphicon-remove-circle"></i>'});return d.click(function(){e.cancelTitleEditing()}),d},_createInput:function(){var e=this,d=$('<input type="text" class="form-control">');return d.on("keyup",function(f){13===f.which&&e.finishTitleEditing()}),d},_showFormError:function(f,d){var e=this.$form.find('[name="'+f+'"]').closest(".form-group").addClass("has-error");e.find(".help-block").remove(),e.append($('<span class="help-block">'+d+"</span>"))},_resetForm:function(){var d=this;d.$form[0].reset(),d.$form[0].id.value="",d.$form.find(".form-group").removeClass("has-error").find(".help-block").remove()},_enableSorting:function(){var d=this;d.$el.find(".lobilist-items").sortable({connectWith:".lobilist .lobilist-items",items:".lobilist-item",handle:".drag-handler",cursor:"move",placeholder:"lobilist-item-placeholder",forcePlaceholderSize:!0,opacity:0.9,revert:70,update:function(e,f){d._triggerEvent("afterItemReorder",[d,f.item])}})},_addItemToList:function(e){var d=this,f=$("<li>",{"data-id":e.id,"class":"lobilist-item"});return f.append($("<div>",{"class":"lobilist-item-title",html:e.title})),e.description&&f.append($("<div>",{"class":"lobilist-item-description",html:e.description})),e.dueDate&&f.append($("<div>",{"class":"lobilist-item-duedate",html:e.dueDate})),f=d._addItemControls(f),e.done&&(f.find("input[type=checkbox]").prop("checked",!0),f.addClass("item-done")),f.data("lobiListItem",e),d.$ul.append(f),d.$items[e.id]=e,d._triggerEvent("afterItemAdd",[d,e]),f},_addItemControls:function(f){var d=this;d.$options.useCheckboxes&&f.append(d._createCheckbox());var e=$("<div>",{"class":"todo-actions"}).appendTo(f);return d.$options.enableTodoEdit&&e.append($("<div>",{"class":"edit-todo todo-action",html:'<i class="glyphicon glyphicon-pencil"></i>'}).click(function(){d.editItem($(this).closest("li").data("id"))})),d.$options.enableTodoRemove&&e.append($("<div>",{"class":"delete-todo todo-action",html:'<i class="glyphicon glyphicon-remove"></i>'}).click(function(){d._onDeleteItemClick($(this).closest("li").data("lobiListItem"))})),f.append($("<div>",{"class":"drag-handler"})),f},_onDeleteItemClick:function(d){this.deleteItem(d)},_updateItemInList:function(e){var d=this,f=d.$lobiList.$el.find('li[data-id="'+e.id+'"]');f.find("input[type=checkbox]").prop("checked",e.done),f.find(".lobilist-item-title").html(e.title),f.find(".lobilist-item-description").remove(),f.find(".lobilist-item-duedate").remove(),e.description&&f.append('<div class="lobilist-item-description">'+e.description+"</div>"),e.dueDate&&f.append('<div class="lobilist-item-duedate">'+e.dueDate+"</div>"),f.data("lobiListItem",e),$.extend(d.$items[e.id],e),d._triggerEvent("afterItemUpdate",[d,e])},_triggerEvent:function(d,f){var e=this;if(!e.eventsSuppressed){return e.$options[d]&&"function"==typeof e.$options[d]?e.$options[d].apply(e,f):e.$el.trigger(d,f)}},_removeItemFromList:function(e){var d=this;d.$lobiList.$el.find("li[data-id="+e.id+"]").remove(),d._triggerEvent("afterItemDelete",[d,e])},_sendAjax:function(d,f){var e=this;return $.ajax(d,e._beforeAjaxSent(f))},_beforeAjaxSent:function(f){var d=this,e=d._triggerEvent("beforeAjaxSent",[d,f]);return $.extend({},f,e||{})}};var c=function(e,d){this.$el=e,this.init(d)};c.prototype={$el:null,$lists:[],$options:{},_nextId:1,eventsSuppressed:!1,init:function(d){var e=this;e.suppressEvents(),e.$options=this._processInput(d),e.$el.addClass("lobilists"),e.$options.onSingleLine&&e.$el.addClass("single-line"),e._createLists(),e._handleSortable(),e._triggerEvent("init",[e]),e.resumeEvents()},_processInput:function(d){return d=$.extend({},$.fn.lobiList.DEFAULT_OPTIONS,d),d.actions.load&&$.ajax(d.actions.load,{async:!1}).done(function(e){d.lists=e.lists}),d},_createLists:function(){for(var e=this,d=0;d<e.$options.lists.length;d++){e.addList(e.$options.lists[d])}return e},_handleSortable:function(){var d=this;return d.$options.sortable?d.$el.sortable({items:".lobilist-wrapper",handle:".lobilist-header",cursor:"move",placeholder:"lobilist-placeholder",forcePlaceholderSize:!0,opacity:0.9,revert:70,update:function(e,f){d._triggerEvent("afterListReorder",[d,f.item.find(".lobilist").data("lobiList")])}}):d.$el.addClass("no-sortable"),d},addList:function(e){var d=this;return e instanceof b||(e=new b(d,d._processListOptions(e))),d._triggerEvent("beforeListAdd",[d,e])!==!1&&(d.$lists.push(e),d.$el.append(e.$elWrapper),e.$el.data("lobiList",e),d._triggerEvent("afterListAdd",[d,e])),e},destroy:function(){var e=this;if(e._triggerEvent("beforeDestroy",[e])!==!1){for(var d=0;d<e.$lists.length;d++){e.$lists[d].remove()}e.$options.sortable&&e.$el.sortable("destroy"),e.$el.removeClass("lobilists"),e.$options.onSingleLine&&e.$el.removeClass("single-line"),e.$el.removeData("lobiList"),e._triggerEvent("afterDestroy",[e])}return e},getNextId:function(){return this._nextId++},_processListOptions:function(e){var f=this;e=$.extend({},f.$options.listsOptions,e);for(var d in f.$options){f.$options.hasOwnProperty(d)&&void 0===e[d]&&(e[d]=f.$options[d])}return e},suppressEvents:function(){return this.eventsSuppressed=!0,this},resumeEvents:function(){return this.eventsSuppressed=!1,this},_triggerEvent:function(d,f){var e=this;if(!e.eventsSuppressed){return e.$options[d]&&"function"==typeof e.$options[d]?e.$options[d].apply(e,f):e.$el.trigger(d,f)}}},$.fn.lobiList=function(f){var e,d=arguments;return this.each(function(){var i=$(this),h=i.data("lobiList"),g="object"==typeof f&&f;h||i.data("lobiList",h=new c(i,g)),"string"==typeof f&&(d=Array.prototype.slice.call(d,1),e=h[f].apply(h,d))})},$.fn.lobiList.DEFAULT_OPTIONS={listStyles:["lobilist-default","lobilist-danger","lobilist-success","lobilist-warning","lobilist-info","lobilist-primary"],listsOptions:{id:!1,title:"",items:[]},itemOptions:{id:!1,title:"",description:"",dueDate:"",done:!1},lists:[],actions:{load:"",update:"",insert:"","delete":""},useCheckboxes:!0,enableTodoRemove:!0,enableTodoEdit:!0,sortable:!0,controls:["edit","add","remove","styleChange"],defaultStyle:"lobilist-default",onSingleLine:!0,init:null,beforeDestroy:null,afterDestroy:null,beforeListAdd:null,afterListAdd:null,beforeListRemove:null,afterListRemove:null,beforeItemAdd:null,afterItemAdd:null,beforeItemUpdate:null,afterItemUpdate:null,beforeItemDelete:null,afterItemDelete:null,afterListReorder:null,afterItemReorder:null,afterMarkAsDone:null,afterMarkAsUndone:null,beforeAjaxSent:null,styleChange:null,titleChange:null}});