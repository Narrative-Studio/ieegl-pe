$(document).ready(function(){$("#sortable2").sortable({axis:"y",handle:".handle",dragClass:"sortable-drag",ghostClass:"ghost-class",dataIdAttr:"id",allowDuplicates:false,onSort:function(a){reorder()}});$("#select_categoria").on("change",function(){$("#sortable .listados").addClass("hidden");$("#sortable #"+$(this).val()).removeClass("hidden")});$('#sortable input[type="checkbox"]').on("change",function(){if($(this).is(":checked")){if($("#sortable2 #"+$(this).val()).length==0){addQuestion($(this).val(),true)}}else{$("#sortable2 #"+$(this).val()).remove()}});$("#guardar_pregunta").on("click",function(){addNewQuestion(true)});if(json!=""){parsePreguntas()}});function addTitle(a){var b=$("#cloneTitle").clone().removeClass("hidden").removeAttr("id").appendTo("#sortable2");window.scrollTo(0,document.body.scrollHeight);if(a){reorder()}else{return b}}function addQuestion(b,a){var c=$("#"+b).clone().appendTo("#sortable2");$("#sortable2 #"+b+" .hidden").removeClass("hidden");$("#sortable2 #"+b+" .custom-checkbox").remove();window.scrollTo(0,document.body.scrollHeight);if(a){reorder()}else{return c}}function addNewQuestion(a){var b=$("#campo_nuevo").clone().removeAttr("id");b.find("select").each(function(c){this.selectedIndex=$("#campo_nuevo").find("select")[c].selectedIndex});$(".hidden",b).removeClass("hidden");$(".form-actions",b).remove();$(".uuid",b).val(uuidv4());$("#sortable2").append(b);window.scrollTo(0,document.body.scrollHeight);if(a){reorder()}else{return b}$("#campo_nuevo input[type='text'], #campo_nuevo textarea").val("");$("#campo_nuevo select").prop("selectedIndex",0)}function deleteItem(a){let del=$(a).parents(".item");var b=del.prop("id");if(b!=""){$("#sortable #"+b).find('input[type="checkbox"]').prop("checked",false)}$(del).remove();reorder()}function muestra(){var a=$("#sortable2").sortable("toArray")}function reorder(){$("#sortable2 .item").each(function(a){var b=$(this);$("input,select,textarea",b).each(function(d){var c="preguntas["+a+"]["+$(this).attr("data-name")+"]";$(this).attr("name",c)})})}function cambioTipoPregunta(b){var a=$(b).parents(".item");if($(b).val()=="combo"||$(b).val()=="multiple"){$(a).find(".nueva_respuestas_select").removeClass("hidden")}else{$(a).find(".nueva_respuestas_select").addClass("hidden");$(a).find(".nueva_respuestas_select").find("textarea").val("")}}function parsePreguntas(){$(".cargador_preguntas").removeClass("hidden");var c=JSON.parse(json);console.log(c);for(var a=0;a<Object.keys(c).length;a++){var d=c[a];if(c[a]!=undefined){switch(c[a].tipo){case"categorias":var b=addTitle(false);$(b).find(".titulos").val(d.nombre);break;case"usuario":var b=addQuestion("usuario_"+d.campo,false);$("#sortable #usuario_"+d.campo).find('input[type="checkbox"]').prop("checked",true);$("input[data-name='nombre']",b).val(d.nombre);$("input[data-name='desc']",b).val(d.desc);break;case"cuenta":var b=addQuestion("cuenta_"+d.campo,false);$("#sortable #cuenta_"+d.campo).find('input[type="checkbox"]').prop("checked",true);$("input[data-name='nombre']",b).val(d.nombre);$("input[data-name='desc']",b).val(d.desc);break;case"emprendimiento":var b=addQuestion("emprendimiento_"+d.campo,false);$("#sortable #emprendimiento_"+d.campo).find('input[type="checkbox"]').prop("checked",true);$("input[data-name='nombre']",b).val(d.nombre);$("input[data-name='desc']",b).val(d.desc);break;case"catalogos":var b=addQuestion("catalogo_"+d.campo,false);$("#sortable #catalogo_"+d.campo).find('input[type="checkbox"]').prop("checked",true);$("input[data-name='nombre']",b).val(d.nombre);$("input[data-name='desc']",b).val(d.desc);break;case"nueva":var b=addNewQuestion(false);$("input[data-name='nombre']",b).val(d.nombre);$("input[data-name='desc']",b).val(d.placeholder);$("select[data-name='tipo_pregunta']",b).val(d.tipo_pregunta);if(d.tipo_pregunta=="combo"||d.tipo_pregunta=="multiple"){$(b).find(".nueva_respuestas_select").removeClass("hidden")}else{$(b).find(".nueva_respuestas_select").addClass("hidden");$(b).find(".nueva_respuestas_select").find("textarea").val("")}if(d.respuestas!=null){$("textarea[data-name='respuestas']",b).val(d.respuestas.replace(/\|/g,"\n"))}break}}}reorder();$(".cargador_preguntas").addClass("hidden")}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d=="x"?b:(b&3|8);return a.toString(16)})};